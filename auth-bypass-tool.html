<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Bypass Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-bottom: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.admin {
            background-color: #e74c3c;
        }
        button.admin:hover {
            background-color: #c0392b;
        }
        button.manager {
            background-color: #f39c12;
        }
        button.manager:hover {
            background-color: #d35400;
        }
        button.cashier {
            background-color: #2ecc71;
        }
        button.cashier:hover {
            background-color: #27ae60;
        }
        button.clear {
            background-color: #95a5a6;
        }
        button.clear:hover {
            background-color: #7f8c8d;
        }
        .links {
            margin-top: 20px;
        }
        .links a {
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 10px;
            color: #3498db;
            text-decoration: none;
            padding: 8px 12px;
            border: 1px solid #3498db;
            border-radius: 4px;
        }
        .links a:hover {
            background-color: #3498db;
            color: white;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .hidden {
            display: none;
        }
        .tab-container {
            margin-top: 20px;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            background-color: #f1f1f1;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 2px;
        }
        .tab-button.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Authentication Bypass Tool</h1>

    <div class="warning">
        <strong>Warning:</strong> This tool is for development and testing purposes only. It allows you to bypass the normal authentication flow by directly setting authentication data in localStorage.
    </div>

    <div class="card">
        <h2>Setup Authentication</h2>
        <p>Click one of the buttons below to set up authentication data for a specific user role:</p>

        <button class="admin" onclick="setupAuth('ADMIN')">Setup as Admin</button>
        <button class="manager" onclick="setupAuth('MANAGER')">Setup as Manager</button>
        <button class="cashier" onclick="setupAuth('CASHIER')">Setup as Cashier</button>
        <button class="clear" onclick="clearAuth()">Clear Authentication</button>

        <div id="status" class="status hidden"></div>
    </div>

    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab(event, 'tab-links')">Application Links</button>
            <button class="tab-button" onclick="openTab(event, 'tab-data')">Current Auth Data</button>
            <button class="tab-button" onclick="openTab(event, 'tab-help')">Help & Instructions</button>
        </div>

        <div id="tab-links" class="tab-content active">
            <h3>Application Links</h3>
            <p>After setting up authentication, you can access these pages:</p>

            <div class="links">
                <a href="http://localhost:5173/" target="_blank">Dashboard</a>
                <a href="http://localhost:5173/users" target="_blank">Users Management</a>
                <a href="http://localhost:5173/roles" target="_blank">Roles Management</a>
                <a href="http://localhost:5173/permissions" target="_blank">Permissions</a>
                <a href="http://localhost:5173/products" target="_blank">Products</a>
                <a href="http://localhost:5173/orders" target="_blank">Orders</a>
                <a href="http://localhost:5173/customers" target="_blank">Customers</a>
                <a href="http://localhost:5173/reports" target="_blank">Reports</a>
                <a href="http://localhost:5173/settings" target="_blank">Settings</a>
            </div>
        </div>

        <div id="tab-data" class="tab-content">
            <h3>Current Authentication Data</h3>
            <p>This shows the current authentication data stored in localStorage:</p>

            <h4>Token:</h4>
            <pre id="current-token">None</pre>

            <h4>User Data:</h4>
            <pre id="current-user">None</pre>
        </div>

        <div id="tab-help" class="tab-content">
            <h3>Help & Instructions</h3>

            <h4>How to use this tool:</h4>
            <ol>
                <li>Click one of the role buttons (Admin, Manager, Cashier) to set up authentication data</li>
                <li>Check the "Current Auth Data" tab to verify the data was set correctly</li>
                <li>Click on any of the application links to access the protected pages</li>
                <li>Use "Clear Authentication" to remove the auth data when you're done</li>
            </ol>

            <h4>Troubleshooting:</h4>
            <ul>
                <li>If a page still shows the login screen, try refreshing the page</li>
                <li>Make sure you're using the correct application URL (default is localhost:5173)</li>
                <li>Check browser console for any errors</li>
                <li>Try clearing browser cache if issues persist</li>
            </ul>
        </div>
    </div>

    <script>
        // Constants
        const TOKEN_KEY = 'auth_token';
        const USER_KEY = 'auth_user';

        // User templates for different roles
        const userTemplates = {
            ADMIN: {
                id: 'admin-123',
                username: 'admin',
                email: 'admin@example.com',
                firstName: 'Admin',
                lastName: 'User',
                fullName: 'Admin User',
                role: 'ADMIN',
                roles: ['ADMIN'],
                permissions: ['*'],
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            },
            MANAGER: {
                id: 'manager-456',
                username: 'manager',
                email: 'manager@example.com',
                firstName: 'Manager',
                lastName: 'User',
                fullName: 'Manager User',
                role: 'MANAGER',
                roles: ['MANAGER'],
                permissions: [
                    'users:read',
                    'settings:read',
                    'reports:read',
                    'products:all',
                    'orders:all',
                    'inventory:all'
                ],
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            },
            CASHIER: {
                id: 'cashier-789',
                username: 'cashier',
                email: 'cashier@example.com',
                firstName: 'Cashier',
                lastName: 'User',
                fullName: 'Cashier User',
                role: 'CASHIER',
                roles: ['CASHIER'],
                permissions: [
                    'products:read',
                    'orders:read',
                    'orders:write',
                    'customers:read'
                ],
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            }
        };

        // Function to set up authentication data
        function setupAuth(role) {
            try {
                // Generate a mock token
                const token = generateMockToken(role);

                // Get the user template for the selected role
                const user = userTemplates[role];

                // Store in localStorage
                localStorage.setItem(TOKEN_KEY, token);
                localStorage.setItem(USER_KEY, JSON.stringify(user));

                // Also set legacy token key for compatibility
                localStorage.setItem('token', token);

                // Update status
                showStatus('success', `Authentication set up successfully for ${role} role`);

                // Update current data display
                updateCurrentDataDisplay();

                // Set session storage flag to prevent navigation throttling
                sessionStorage.setItem('navigation_throttle_prevented', 'true');

                // Mark problematic routes as handled
                const problematicRoutes = ['/users', '/roles', '/permissions'];
                problematicRoutes.forEach(route => {
                    const routeKey = `route_handled_${route.replace(/\//g, '_')}`;
                    sessionStorage.setItem(routeKey, 'true');
                });

                console.log(`Authentication bypass set up for ${role} role`);
            } catch (error) {
                showStatus('error', `Error setting up authentication: ${error.message}`);
                console.error('Auth setup error:', error);
            }
        }

        // Function to clear authentication data
        function clearAuth() {
            try {
                localStorage.removeItem(TOKEN_KEY);
                localStorage.removeItem(USER_KEY);
                localStorage.removeItem('token');

                // Clear session storage flags
                Object.keys(sessionStorage).forEach(key => {
                    if (key.startsWith('route_handled_') || key === 'navigation_throttle_prevented') {
                        sessionStorage.removeItem(key);
                    }
                });

                showStatus('success', 'Authentication data cleared successfully');
                updateCurrentDataDisplay();

                console.log('Authentication data cleared');
            } catch (error) {
                showStatus('error', `Error clearing authentication: ${error.message}`);
                console.error('Auth clear error:', error);
            }
        }

        // Function to generate a mock JWT token
        function generateMockToken(role) {
            // Create a simple mock token structure
            const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));

            // Create payload with user data and expiration
            const now = Math.floor(Date.now() / 1000);
            const payload = btoa(JSON.stringify({
                sub: userTemplates[role].id,
                name: userTemplates[role].fullName,
                email: userTemplates[role].email,
                role: role,
                permissions: userTemplates[role].permissions,
                iat: now,
                exp: now + 86400 // 24 hours
            }));

            // Create signature (mock)
            const signature = btoa('mock-signature');

            // Combine to form JWT
            return `${header}.${payload}.${signature}`;
        }

        // Function to show status message
        function showStatus(type, message) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.classList.remove('hidden');

            // Hide after 5 seconds
            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 5000);
        }

        // Function to update current data display
        function updateCurrentDataDisplay() {
            const tokenElement = document.getElementById('current-token');
            const userElement = document.getElementById('current-user');

            const token = localStorage.getItem(TOKEN_KEY) || localStorage.getItem('token');
            const userJson = localStorage.getItem(USER_KEY);

            tokenElement.textContent = token ? token : 'None';

            if (userJson) {
                try {
                    const user = JSON.parse(userJson);
                    userElement.textContent = JSON.stringify(user, null, 2);
                } catch (error) {
                    userElement.textContent = `Error parsing user data: ${error.message}`;
                }
            } else {
                userElement.textContent = 'None';
            }
        }

        // Function to handle tab switching
        function openTab(evt, tabId) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            // Remove active class from all tab buttons
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }

            // Show the selected tab content and mark button as active
            document.getElementById(tabId).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDataDisplay();
        });
    </script>
</body>
</html>
